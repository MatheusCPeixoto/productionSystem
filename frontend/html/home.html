<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Apontamento de Produção - Principal</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #f0f2f5; }
        .modal { display: none; }
        .modal.active { display: flex; }

        /* Efeito de piscar para status "Parado" */
        @keyframes blinkOpacityEffect {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        .status-parado-blinking {
            animation: blinkOpacityEffect 1.5s infinite ease-in-out;
        }

        /* Área de Mensagem Principal (reserva espaço para não distorcer o layout) */
        #mainMessageArea {
            text-align: center; font-size: 0.875rem; line-height: 1.25rem;
            border-radius: 0.375rem; padding: 0.75rem; margin-top: 1rem; margin-bottom: 1rem;
            min-height: 2.75rem; visibility: hidden; opacity: 0;
            transition: opacity 0.3s ease-in-out, visibility 0s linear 0.3s;
        }
        #mainMessageArea.visible { visibility: visible; opacity: 1; transition: opacity 0.3s ease-in-out; }
        .message-type-info { background-color: #dbeafe; color: #1e40af; }
        .message-type-error { background-color: #fee2e2; color: #991b1b; }
        .message-type-success { background-color: #d1fae5; color: #065f46; }

        /* Estilo Hover para botões de ação nos cartões */
        .btn-action-card {
            transition: transform 0.15s ease-out;
        }
        .btn-action-card:hover {
            transform: translateY(-1px) scale(1.05);
        }
    </style>
</head>
<body class="min-h-screen">

<header class="bg-sky-700 text-white p-4 shadow-md fixed w-full top-0 z-10">
    <div class="container mx-auto flex flex-wrap justify-between items-center gap-4">
        <div class="text-lg font-semibold order-1">
            <i class="fas fa-user-circle mr-2"></i>
            <span id="userInfoDisplay">Carregando...</span>
        </div>
        <div class="flex items-center space-x-2 order-2 sm:order-3 sm:ml-auto">
            <button id="triggerOpenOrderModalButton" class="bg-sky-500 hover:bg-sky-600 text-white font-semibold py-2 px-3 rounded-md flex items-center space-x-2 text-sm transition duration-150">
                <i class="fas fa-plus-circle"></i>
                <span>Abrir Ordem</span>
            </button>
            <button id="changeOpEqButton" class="bg-orange-500 hover:bg-orange-600 text-white font-semibold py-2 px-3 rounded-md flex items-center space-x-2 text-sm transition duration-150">
                <i class="fas fa-exchange-alt"></i>
                <span class="hidden sm:inline">Trocar Op/Eq</span>
                <span class="sm:hidden">Op/Eq</span>
            </button>
            <button id="switchModeButton" class="bg-teal-500 hover:bg-teal-600 text-white font-semibold py-2 px-3 rounded-md flex items-center space-x-2 text-sm transition duration-150">
                <i class="fas fa-sync-alt"></i>
                <span id="switchModeButtonText">Alternar Modo</span>
            </button>
        </div>
    </div>
</header>

<main class="container mx-auto pt-24 pb-8 px-4">
    <div id="mainMessageArea" class="mb-6"></div>

    <section class="mb-8">
        <div class="flex flex-col sm:flex-row justify-between items-center mb-4">
            <h2 class="text-xl sm:text-2xl font-semibold text-gray-800 mb-3 sm:mb-0">Apontamentos em Andamento</h2>
            <div class="relative w-full sm:w-auto">
                <span class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none"><i class="fas fa-search text-gray-400"></i></span>
                <input type="text" id="searchInputOngoingTasks" class="pl-10 pr-3 py-2 rounded-md border border-gray-300 text-gray-700 focus:outline-none focus:ring-2 focus:ring-sky-500 focus:border-transparent w-full sm:w-64" placeholder="Pesquisar ordens...">
            </div>
        </div>

        <div id="ongoingTasksCardsContainer" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6"></div>
        <div id="noOngoingTasksMessage" class="text-center py-10 text-gray-500 hidden"></div>
    </section>
</main>

<div id="orderInteractionModal" class="modal fixed inset-0 bg-gray-800 bg-opacity-75 items-center justify-center z-20 p-4">
    <div class="bg-white p-6 rounded-lg shadow-xl w-full max-w-lg">
        <div class="flex justify-between items-center mb-4">
            <h3 id="orderInteractionModalTitle" class="text-lg font-semibold text-gray-700"></h3>
            <button id="closeOrderInteractionModal" class="text-gray-500 hover:text-gray-700"><i class="fas fa-times fa-lg"></i></button>
        </div>
        <div id="orderInteractionModalContent"></div>
        <div id="orderInteractionModalMessageArea" class="mt-4 text-sm"></div>
    </div>
</div>

<div id="opEqModal" class="modal fixed inset-0 bg-gray-800 bg-opacity-75 items-center justify-center z-30 p-4">
    <div class="bg-white p-6 rounded-lg shadow-xl w-full max-w-md">
        <h3 class="text-lg font-semibold mb-4 text-gray-700">Informações Adicionais</h3>
        <form id="opEqForm" class="space-y-4">
            <div id="operatorInputGroup" class="hidden">
                <label for="modalOperatorCode" class="block text-sm font-medium text-gray-700 mb-1">Cód. Operador:</label>
                <input type="text" id="modalOperatorCode" class="w-full p-2 border border-gray-300 rounded-md">
            </div>
            <div id="equipmentInputGroup" class="hidden">
                <label for="modalEquipmentCode" class="block text-sm font-medium text-gray-700 mb-1">Cód. Equipamento:</label>
                <input type="text" id="modalEquipmentCode" class="w-full p-2 border border-gray-300 rounded-md">
            </div>
            <div id="opEqModalMessageArea" class="text-sm"></div>
            <div class="flex justify-end space-x-3 pt-2">
                <button type="button" id="closeOpEqModal" class="px-4 py-2 bg-gray-300 text-gray-700 rounded-md hover:bg-gray-400">Cancelar</button>
                <button type="submit" class="px-4 py-2 bg-sky-600 text-white rounded-md hover:bg-sky-700">Confirmar</button>
            </div>
        </form>
    </div>
</div>

<div id="stopReasonModal" class="modal fixed inset-0 bg-gray-800 bg-opacity-75 items-center justify-center z-20 p-4">
    <div class="bg-white p-6 rounded-lg shadow-xl w-full max-w-md space-y-4">
        <h3 class="text-lg font-semibold text-gray-700">Motivo da Parada</h3>
        <input type="hidden" id="stopModalOrderId"> <input type="hidden" id="stopModalActivityId">
        <select id="stopReasonSelect" class="w-full p-2 border border-gray-300 rounded-md"></select>
        <div id="stopReasonModalMessageArea" class="text-sm"></div>
        <div class="flex justify-end space-x-3">
            <button type="button" id="closeStopReasonModal" class="px-4 py-2 bg-gray-300 text-gray-700 rounded-md hover:bg-gray-400">Cancelar</button>
            <button type="button" id="submitStopReason" class="px-4 py-2 bg-sky-600 text-white rounded-md hover:bg-sky-700">Confirmar Parada</button>
        </div>
    </div>
</div>

<div id="finalizeTaskModal" class="modal fixed inset-0 bg-gray-800 bg-opacity-75 items-center justify-center z-20 p-4">
    <div class="bg-white p-6 rounded-lg shadow-xl w-full max-w-md space-y-4">
        <h3 class="text-lg font-semibold text-gray-700">Finalizar Atividade</h3>
        <input type="hidden" id="finalizeModalOrderId"> <input type="hidden" id="finalizeModalActivityId">
        <div>
            <label for="finalizeQuantityInput" class="block text-sm font-medium text-gray-700 mb-1">Quantidade Produzida:</label>
            <input type="number" id="finalizeQuantityInput" class="w-full p-2 border border-gray-300 rounded-md" min="0" required>
        </div>
        <div id="finalizeTaskModalMessageArea" class="text-sm"></div>
        <div class="flex justify-end space-x-3">
            <button type="button" id="closeFinalizeTaskModal" class="px-4 py-2 bg-gray-300 text-gray-700 rounded-md hover:bg-gray-400">Cancelar</button>
            <button type="button" id="submitFinalizeTask" class="px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700">Confirmar</button>
        </div>
    </div>
</div>

<div id="ncModal" class="modal fixed inset-0 bg-gray-800 bg-opacity-75 items-center justify-center z-20 p-4">
    <div class="bg-white p-6 rounded-lg shadow-xl w-full max-w-md space-y-4">
        <h3 class="text-lg font-semibold text-gray-700">Registrar Não Conformidade</h3>
        <input type="hidden" id="ncModalOrderId"> <input type="hidden" id="ncModalActivityId">
        <div>
            <label for="ncReasonSelect" class="block text-sm font-medium text-gray-700 mb-1">Motivo:</label>
            <select id="ncReasonSelect" class="w-full p-2 border border-gray-300 rounded-md"></select>
        </div>
        <div>
            <label for="ncQuantityInput" class="block text-sm font-medium text-gray-700 mb-1">Quantidade NC:</label>
            <input type="number" id="ncQuantityInput" class="w-full p-2 border border-gray-300 rounded-md" min="0" required>
        </div>
        <div id="ncModalMessageArea" class="text-sm"></div>
        <div class="flex justify-end space-x-3">
            <button type="button" id="closeNcModal" class="px-4 py-2 bg-gray-300 text-gray-700 rounded-md hover:bg-gray-400">Cancelar</button>
            <button type="button" id="submitNc" class="px-4 py-2 bg-red-600 text-white rounded-md hover:bg-red-700">Registrar</button>
        </div>
    </div>
</div>

<script src="../script/home.js"></script>
</body>
</html>